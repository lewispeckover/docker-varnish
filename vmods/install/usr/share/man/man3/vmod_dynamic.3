.\" Man page generated from reStructuredText.
.
.TH VMOD_DYNAMIC 3 "" "" ""
.SH NAME
vmod_dynamic \- Varnish DNS Director Module
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.\" 
.
.\" NB:  This file is machine generated, DO NOT EDIT!
.
.\" 
.
.\" Edit vmod.vcc and run make instead
.
.\" 
.
.SH SYNOPSIS
.sp
import dynamic [from "path"] ;
.SH DESCRIPTION
.sp
This module provides a DNS director implementation with limited capabilities.
It currently relies on the default timeouts. DNS lookups are operated by
background threads, one per DNS director domain, and rely on your system\(aqs
resolver.
.sp
Backends are created and deleted depending on the lookup results, you can
monitor them over time just like regular backends. They will appear in
\fBvarnishstat\fP\(aqs or any other similar tool\(aqs output. The counters will be
dynamic according to the following pattern:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
VBE.<configname>.<directorname>(<ip>).*
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
When a lookup fails, the backends are left untouched and the error will be
logged with the following event:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
getaddrinfo <errno> (<reason>)
.ft P
.fi
.UNINDENT
.UNINDENT
.SH LOGGING
.sp
This module may log \fBVCL_Log\fP and \fBError\fP records following a common
pattern:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
vmod\-dynamic: %s %s %s %s [ %s ]
            |  |  |  |    |
            |  |  |  |    +\- Additional information
            |  |  |  +\-\-\-\-\-\- Event
            |  |  +\-\-\-\-\-\-\-\-\- Host name
            |  +\-\-\-\-\-\-\-\-\-\-\-\- Director name
            +\-\-\-\-\-\-\-\-\-\-\-\-\-\-\- VCL name
.ft P
.fi
.UNINDENT
.UNINDENT
.SH CONTENTS
.INDENT 0.0
.IP \(bu 2
Object director
.IP \(bu 2
BACKEND director.backend(STRING)
.UNINDENT
.SH OBJECT DIRECTOR
.INDENT 0.0
.TP
.B Description
Create a DNS director.
.sp
The director creates backends with DNS lookups and chooses them in a
round robin fashion. It accepts the following parameters:
.INDENT 7.0
.IP \(bu 2
\fIport\fP (defaults to \fB"http"\fP)
.IP \(bu 2
\fIhost_header\fP (defaults to none)
.IP \(bu 2
\fIprobe\fP (defaults to none)
.IP \(bu 2
\fIwhitelist\fP \- an acl (defaults to none)
.IP \(bu 2
\fIttl\fP \- delay between lookups (defaults to one hour)
.IP \(bu 2
\fIconnect_timeout\fP (defaults to global \fIconnect_timeout\fP)
.IP \(bu 2
\fIfirst_byte_timeout\fP (defaults to global \fIfirst_byte_timeout\fP)
.IP \(bu 2
\fIbetween_bytes_timeout\fP (defaults to global \fIbetween_bytes_timeout\fP)
.IP \(bu 2
\fIdomain_usage_timeout\fP \- delay until an unused domain and its
backends are removed (defaults to two hours)
.IP \(bu 2
\fIfirst_lookup_timeout\fP \- delay until the director fails to provide a
backend when a domain is requested for the first time (defaults to
ten seconds)
.UNINDENT
.TP
.B Example
.INDENT 7.0
.INDENT 3.5
.sp
.nf
.ft C
probe www_probe {
     .window = 8;
     .initial = 7;
     .threshold = 6;
     .interval = 5s;
}

acl www_acl {
     "192.168"/24;
}

sub vcl_init {
     new www_dir = dynamic.director(
             port = "80",
             probe = www_probe,
             whitelist = www_acl,
             ttl = 5m);
}

sub vcl_recv {
     set req.backend_hint = www_dir.backend("production.acme.com");
}
.ft P
.fi
.UNINDENT
.UNINDENT
.UNINDENT
.SS BACKEND director.backend(STRING)
.INDENT 0.0
.TP
.B Prototype
BACKEND director.backend(STRING host)
.TP
.B Description
Pick a backend from the director for a given host name. If the host
is not specified, it is picked from either \fBbereq\fP or \fBreq\fP\&.
.UNINDENT
.SH SEE ALSO
.sp
\fBvcl\fP(7),
\fBvarnish\-cli\fP(7),
\fBvarnish\-counters\fP(7),
\fBvarnishstat\fP(1),
\fBgetaddrinfo\fP(3)
.SH COPYRIGHT
.sp
This document is licensed under the same licence as vmod\-dynamic itself. See
LICENCE for details.
.sp
Copyright (c) 2015\-2016 Dridi Boukelmoune
.\" Generated by docutils manpage writer.
.
